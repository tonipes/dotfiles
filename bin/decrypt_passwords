#!/bin/bash

INPUT=$1
OUTPUT=$2

if [ -z "$INPUT" ] || [ -z "$OUTPUT" ]; then
  echo "Give input and output folders"
  exit 1
else
  echo $INPUT
  echo $OUTPUT
fi

for line in $(find "$INPUT" -name '*.gpg'); do
  
  in_name=$(basename "${line}" .gpg)
  in_path=$(dirname "${line}")
  in_rel_path=$(realpath --relative-to="${INPUT}" "${in_path}")

  output_path="$OUTPUT/$in_rel_path"
  output_full="$output_path/$in_name"

  echo "PATH: $output_path"
  echo "FULL: $output_full"
  mkdir -p "$output_path"
  gpg -d "$line" > "$output_full"
done
