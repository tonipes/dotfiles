#!/bin/bash

INPUT=$1
OUTPUT=$2
USER=$3

if [ -z "$INPUT" ] || [ -z "$OUTPUT" ]; then
  echo "Give input and output folders and user id"
  exit 1
else
  echo $INPUT
  echo $OUTPUT
  echo $USER
fi

for line in $(find "$INPUT" -type f); do
  
  in_name=$(basename "${line}")
  in_path=$(dirname "${line}")
  in_rel_path=$(realpath --relative-to="${INPUT}" "${in_path}")

  output_path="$OUTPUT/$in_rel_path"
  output_full="$output_path/$in_name"

  echo "LINE: $line"
  echo "PATH: $output_path"
  echo "FULL: $output_full"
  
  mkdir -p "$output_path"
  cp "$line" "$output_full"
  gpg -e -r "$USER" "$output_full"
  rm -f "$output_full"
  echo "#########################"
done
